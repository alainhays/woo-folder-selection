/**
 * Woo Folder Selection - v0.1.0 - 2017-08-30 | http://pluginever.com | Copyright (c) 2017; | Licensed GPLv2+
 */

!function($,undefined){function _ExecuteQueue(){!_active&&_queue.length&&_CreateMessageBox(_queue.shift())}function _CreateMessageBox(instance){var settings=instance.settings;_active=instance;var overlay=$("<div>",{class:"messagebox_overlay"}).css(_css.overlay).appendTo("body"),spacer=$("<div>",{class:"messagebox_spacer"}).css(_css.spacer).appendTo(overlay),messageBox=$("<div>",{class:"messagebox"}).addClass(settings.customClass).css(_css.messagebox).data("instance",instance).appendTo(overlay);settings.width&&messageBox.outerWidth(settings.width);var content=$("<div>",{class:"messagebox_content",html:settings.message}).css(_css.content).appendTo(messageBox);if(!1!==settings.input&&settings.input!==undefined&&null!==settings.input){var inputs=$("<div>",{class:"messagebox_content_inputs",css:_css.boxSizing}).appendTo(content);_ParseInputs(settings.input).appendTo(inputs).first().trigger("focus")}$("<div>",{class:"messagebox_content_error",css:_css.boxSizing}).hide().appendTo(content);var buttonsWrapper=$("<div>",{class:"messagebox_buttons"}).css(_css.buttons).appendTo(messageBox);if(settings.buttonDone){buttons=$([]);"string"==typeof settings.buttonDone?buttons=buttons.add(_CreateButton("messagebox_button_done",_constants.buttonDoneName,{text:settings.buttonDone,keyCode:_constants.keyCodeDone.concat(settings.buttonFail?[]:_constants.keyCodeFail)},instance)):$.each(settings.buttonDone,function(name,definition){buttons=buttons.add(_CreateButton("messagebox_button_done",name,definition,instance))}),buttons.appendTo(buttonsWrapper)}if(settings.buttonFail){var buttons=$([]);"string"==typeof settings.buttonFail?buttons=buttons.add(_CreateButton("messagebox_button_fail",_constants.buttonFailName,{text:settings.buttonFail,keyCode:_constants.keyCodeFail},instance)):$.each(settings.buttonFail,function(name,definition){buttons=buttons.add(_CreateButton("messagebox_button_fail",name,definition,instance))}),0===$.trim(settings.buttonsOrder).toLowerCase().indexOf("d")?buttons.appendTo(buttonsWrapper):buttons.prependTo(buttonsWrapper)}var spacerHeight=0,spacerTopMargin=0-messageBox.outerHeight()-_constants.topBuffer;"auto"===$.trim(settings.top).toLowerCase()?(overlay.css("justify-content","center"),spacerTopMargin-=$(window).height()):(overlay.css("justify-content","flex-start"),spacerHeight=settings.top,"%"===$.trim(settings.top).toLowerCase().slice(-1)?messageBox.css("max-height",100-parseInt(settings.top,10)*_constants.maxHeightCoefficient+"%"):messageBox.data("fRefreshMaxHeight",!0)),spacer.data("spacerTopMargin",spacerTopMargin).css({height:0,"margin-top":spacerTopMargin}).animate({height:spacerHeight,"margin-top":0},settings.speed,function(){_SetMaxHeight(messageBox,$(window).height())})}function _CreateButton(mainClass,name,definition,instance){"string"==typeof definition&&(definition={text:definition});var button=$("<button>",{class:mainClass,text:definition.text||""}).addClass(definition.class).css(_css.boxSizing).on("click",{name:name},_Button_Click);return $.each(_ParseKeycodes(definition.keyCode),function(i,keyCode){instance.keyCodes[keyCode]=button}),button}function _ParseKeycodes(keyCodes){"number"!=typeof keyCodes&&"string"!=typeof keyCodes||(keyCodes=[keyCodes]);var ret=[];return $.isArray(keyCodes)&&(ret=$.map(keyCodes,function(keycode){return parseInt(keycode,10)||undefined})),ret}function _ParseInputs(settingsInput){if(!0===settingsInput||"string"==typeof settingsInput)return _FormatInput($("<input>",{value:!0===settingsInput?"":settingsInput,type:"text"}),{autotrim:!0});if($.isArray(settingsInput)){ret=$([]);return $.each(settingsInput,function(i,value){ret=ret.add(_FormatInput($("<input>",{value:value,type:"text"}),{autotrim:!0}))}),ret}if($.isPlainObject(settingsInput)){var ret=$([]);return $.each(settingsInput,function(name,definition){var input=_CreateInput(name,definition);if(definition.label!==undefined){var label=$("<label>",{class:"messagebox_content_label",css:_css.boxSizing,text:definition.label});input.appendTo(label),ret=ret.add(label)}else ret=ret.add(input)}),ret}return $(settingsInput)}function _CreateInput(name,definition){var type=$.trim(definition.type).toLowerCase();switch(type){case"select":var select=_FormatInput($("<select>"),{name:name,title:definition.title,autotrim:!1}),options=$.isArray(definition.options)?definition.options.reduce(function(ret,item){return ret[item]=item,ret},{}):definition.options;options||(_Warning('No options provided for "'+name+'"'),options={"":"&nbsp;"});var defaultSelected=!1;return $.each(options,function(value,html){var option=$("<option>",{value:value,html:html}).appendTo(select);definition.default==value&&(option.prop("selected",!0),defaultSelected=!0)}),defaultSelected||($("<option>",{value:"",text:definition.title}).prop({disabled:!0,selected:!0,hidden:!0}).prependTo(select),select.find("option").css("color",select.css("color")),select.addClass("messagebox_content_input_selectplaceholder").prop("selectedIndex",0).one("change",function(){select.find("option").css("color",""),select.removeClass("messagebox_content_input_selectplaceholder")})),select;case"text":case"password":default:return _FormatInput($("<input>",{type:"password"===type?"password":"text",maxlength:definition.maxlength,placeholder:definition.title,value:definition.default}),{name:name,title:definition.title,autotrim:definition.autotrim})}}function _FormatInput(input,par){return!1!==par.autotrim&&input.on("blur",_Input_Blur),input.addClass("messagebox_content_input").css(_css.boxSizing).attr({name:par.name,title:par.title})}function _GetInputsValues(messageBox){var names=[],values=[];if(messageBox.find(".messagebox_content_inputs").find("input, select").each(function(){var input=$(this);names.push(input.attr("name")),values.push(input.val())}),!values.length)return undefined;var retObject={},valuesOnly=!1;return $.each(names,function(i,name){if(name===undefined)return valuesOnly=!0,!1;retObject[name]=values[i]}),valuesOnly&&1===values.length?values[0]:valuesOnly?values:retObject}function _SetMaxHeight(messageBox,h){messageBox.data("fRefreshMaxHeight")&&messageBox.css("max-height",h-messageBox.offset().top*_constants.maxHeightCoefficient)}function _Warning(message){message="jQuery MessageBox Warning: "+message,window.console.warn?console.warn(message):window.console.log&&console.log(message)}function _Input_Blur(event){var input=$(event.currentTarget);input.val($.trim(input.val()))}function _Button_Click(event){var button=$(event.currentTarget),buttonName=event.data.name,messageBox=button.closest(".messagebox"),overlay=messageBox.closest(".messagebox_overlay"),spacer=overlay.children(".messagebox_spacer").first(),content=messageBox.children(".messagebox_content").first(),error=content.children(".messagebox_content_error").first(),instance=messageBox.data("instance"),inputValues=_GetInputsValues(messageBox),filterFunc=button.hasClass("messagebox_button_done")?instance.settings.filterDone:instance.settings.filterFail;error.hide().empty(),("function"!==$.type(filterFunc)?$.Deferred().resolve():$.when(filterFunc(inputValues,buttonName)).then(function(ret){if(!1===ret)return $.Deferred().reject();var retType=$.type(ret);return"error"===retType?$.Deferred().reject(ret.message):"string"===retType||"object"===retType||"array"===retType?$.Deferred().reject(ret):$.Deferred().resolve()})).then(function(){spacer.animate({height:0,"margin-top":spacer.data("spacerTopMargin")},instance.settings.speed,function(){overlay.remove(),button.hasClass("messagebox_button_done")?instance.deferred.resolve(inputValues,buttonName):instance.deferred.reject(inputValues,buttonName),_activeStack.length?_active=_activeStack.pop():(_active=undefined,_ExecuteQueue())})},function(errorMessage){var errorMessageType=$.type(errorMessage);"string"!==errorMessageType&&"object"!==errorMessageType&&"array"!==errorMessageType||error.css("max-width",content.width()).append(errorMessage).slideDown(_constants.errorSpeed,function(){content.scrollTop(content.height())})})}function _Window_Resize(event){if(_active){var w=$(event.currentTarget).width(),h=$(event.currentTarget).height();$(document).find(".messagebox").each(function(){var messageBox=$(this);messageBox.css("min-width",messageBox.outerWidth()>w?w:""),_SetMaxHeight(messageBox,h)})}}function _Window_KeyDown(event){if(_active){var button=_active.keyCodes[event.which];button&&(button.closest(".messagebox").find(".messagebox_content_input").trigger("blur"),button.trigger("click"))}}var _defaults={buttonDone:"OK",buttonFail:undefined,buttonsOrder:"done fail",customClass:"",filterDone:undefined,filterFail:undefined,input:!1,message:"",queue:!0,speed:200,top:"25%",width:"auto"},_css={overlay:{"box-sizing":"border-box",display:"flex","flex-flow":"column nowrap","align-items":"center",position:"fixed",top:"0",left:"0",width:"100%",height:"100%"},spacer:{"box-sizing":"border-box",flex:"0 1 auto"},messagebox:{"box-sizing":"border-box",flex:"0 1 auto",display:"flex","flex-flow":"column nowrap"},content:{"box-sizing":"border-box",flex:"0 1 auto","overflow-y":"auto"},buttons:{"box-sizing":"border-box",flex:"0 0 auto"},boxSizing:{"box-sizing":"border-box"}},_active=undefined,_activeStack=[],_queue=[],_constants={buttonDoneName:"buttonDone",buttonFailName:"buttonFail",errorSpeed:200,keyCodeDone:[13],keyCodeFail:[27],maxHeightCoefficient:1.5,topBuffer:100};$.MessageBoxSetup=function(options){$.extend(!0,_defaults,options)},$.MessageBox=function(options){$.isPlainObject(options)||(options={message:options});var deferred=$.Deferred(),settings=$.extend(!0,{},_defaults,options);settings.top=$.trim(settings.top).toLowerCase(),$(document.activeElement).not(".messagebox_content_input").trigger("blur");var instance={deferred:deferred,keyCodes:{},settings:settings};return settings.queue?(_queue.push(instance),_ExecuteQueue()):(_active&&_activeStack.push(_active),_CreateMessageBox(instance)),deferred.promise()},$(function(){$(window).on("resize",_Window_Resize).on("keydown",_Window_KeyDown)})}(jQuery),function(e,t){function o(){!h&&y.length&&n(y.shift())}function n(o){var n=o.settings;h=o;var a=e("<div>",{class:"messagebox_overlay"}).css(x.overlay).appendTo("body"),r=e("<div>",{class:"messagebox_spacer"}).css(x.spacer).appendTo(a),c=e("<div>",{class:"messagebox"}).addClass(n.customClass).css(x.messagebox).data("instance",o).appendTo(a);n.width&&c.outerWidth(n.width);var u=e("<div>",{class:"messagebox_content",html:n.message}).css(x.content).appendTo(c);if(!1!==n.input&&n.input!==t&&null!==n.input){var l=e("<div>",{class:"messagebox_content_inputs",css:x.boxSizing}).appendTo(u);i(n.input).appendTo(l).first().trigger("focus")}e("<div>",{class:"messagebox_content_error",css:x.boxSizing}).hide().appendTo(u);var p=e("<div>",{class:"messagebox_buttons"}).css(x.buttons).appendTo(c);if(n.buttonDone){f=e([]);"string"==typeof n.buttonDone?f=f.add(s("messagebox_button_done",_.buttonDoneName,{text:n.buttonDone,keyCode:_.keyCodeDone.concat(n.buttonFail?[]:_.keyCodeFail)},o)):e.each(n.buttonDone,function(e,t){f=f.add(s("messagebox_button_done",e,t,o))}),f.appendTo(p)}if(n.buttonFail){var f=e([]);"string"==typeof n.buttonFail?f=f.add(s("messagebox_button_fail",_.buttonFailName,{text:n.buttonFail,keyCode:_.keyCodeFail},o)):e.each(n.buttonFail,function(e,t){f=f.add(s("messagebox_button_fail",e,t,o))}),0===e.trim(n.buttonsOrder).toLowerCase().indexOf("d")?f.appendTo(p):f.prependTo(p)}var g=0,b=0-c.outerHeight()-_.topBuffer;"auto"===e.trim(n.top).toLowerCase()?(a.css("justify-content","center"),b-=e(window).height()):(a.css("justify-content","flex-start"),g=n.top,"%"===e.trim(n.top).toLowerCase().slice(-1)?c.css("max-height",100-parseInt(n.top,10)*_.maxHeightCoefficient+"%"):c.data("fRefreshMaxHeight",!0)),r.data("spacerTopMargin",b).css({height:0,"margin-top":b}).animate({height:g,"margin-top":0},n.speed,function(){d(c,e(window).height())})}function s(t,o,n,s){"string"==typeof n&&(n={text:n});var i=e("<button>",{class:t,text:n.text||""}).addClass(n.class).css(x.boxSizing).on("click",{name:o},f);return e.each(a(n.keyCode),function(e,t){s.keyCodes[t]=i}),i}function a(o){"number"!=typeof o&&"string"!=typeof o||(o=[o]);var n=[];return e.isArray(o)&&(n=e.map(o,function(e){return parseInt(e,10)||t})),n}function i(o){if(!0===o||"string"==typeof o)return c(e("<input>",{value:!0===o?"":o,type:"text"}),{autotrim:!0});if(e.isArray(o)){n=e([]);return e.each(o,function(t,o){n=n.add(c(e("<input>",{value:o,type:"text"}),{autotrim:!0}))}),n}if(e.isPlainObject(o)){var n=e([]);return e.each(o,function(o,s){var a=r(o,s);if(s.label!==t){var i=e("<label>",{class:"messagebox_content_label",css:x.boxSizing,text:s.label});a.appendTo(i),n=n.add(i)}else n=n.add(a)}),n}return e(o)}function r(t,o){var n=e.trim(o.type).toLowerCase();switch(n){case"select":var s=c(e("<select>"),{name:t,title:o.title,autotrim:!1}),a=e.isArray(o.options)?o.options.reduce(function(e,t){return e[t]=t,e},{}):o.options;a||(l('No options provided for "'+t+'"'),a={"":"&nbsp;"});var i=!1;return e.each(a,function(t,n){var a=e("<option>",{value:t,html:n}).appendTo(s);o.default==t&&(a.prop("selected",!0),i=!0)}),i||(e("<option>",{value:"",text:o.title}).prop({disabled:!0,selected:!0,hidden:!0}).prependTo(s),s.find("option").css("color",s.css("color")),s.addClass("messagebox_content_input_selectplaceholder").prop("selectedIndex",0).one("change",function(){s.find("option").css("color",""),s.removeClass("messagebox_content_input_selectplaceholder")})),s;case"text":case"password":default:return c(e("<input>",{type:"password"===n?"password":"text",maxlength:o.maxlength,placeholder:o.title,value:o.default}),{name:t,title:o.title,autotrim:o.autotrim})}}function c(e,t){return!1!==t.autotrim&&e.on("blur",p),e.addClass("messagebox_content_input").css(x.boxSizing).attr({name:t.name,title:t.title})}function u(o){var n=[],s=[];if(o.find(".messagebox_content_inputs").find("input, select").each(function(){var t=e(this);n.push(t.attr("name")),s.push(t.val())}),!s.length)return t;var a={},i=!1;return e.each(n,function(e,o){return o===t?(i=!0,!1):void(a[o]=s[e])}),i&&1===s.length?s[0]:i?s:a}function d(e,t){e.data("fRefreshMaxHeight")&&e.css("max-height",t-e.offset().top*_.maxHeightCoefficient)}function l(e){e="jQuery MessageBox Warning: "+e,window.console.warn?console.warn(e):window.console.log&&console.log(e)}function p(t){var o=e(t.currentTarget);o.val(e.trim(o.val()))}function f(n){var s=e(n.currentTarget),a=n.data.name,i=s.closest(".messagebox"),r=i.closest(".messagebox_overlay"),c=r.children(".messagebox_spacer").first(),d=i.children(".messagebox_content").first(),l=d.children(".messagebox_content_error").first(),p=i.data("instance"),f=u(i),g=s.hasClass("messagebox_button_done")?p.settings.filterDone:p.settings.filterFail;l.hide().empty(),("function"!==e.type(g)?e.Deferred().resolve():e.when(g(f,a)).then(function(t){if(!1===t)return e.Deferred().reject();var o=e.type(t);return"error"===o?e.Deferred().reject(t.message):"string"===o||"object"===o||"array"===o?e.Deferred().reject(t):e.Deferred().resolve()})).then(function(){c.animate({height:0,"margin-top":c.data("spacerTopMargin")},p.settings.speed,function(){r.remove(),s.hasClass("messagebox_button_done")?p.deferred.resolve(f,a):p.deferred.reject(f,a),v.length?h=v.pop():(h=t,o())})},function(t){var o=e.type(t);"string"!==o&&"object"!==o&&"array"!==o||l.css("max-width",d.width()).append(t).slideDown(_.errorSpeed,function(){d.scrollTop(d.height())})})}function g(t){if(h){var o=e(t.currentTarget).width(),n=e(t.currentTarget).height();e(document).find(".messagebox").each(function(){var t=e(this);t.css("min-width",t.outerWidth()>o?o:""),d(t,n)})}}function b(e){if(h){var t=h.keyCodes[e.which];t&&(t.closest(".messagebox").find(".messagebox_content_input").trigger("blur"),t.trigger("click"))}}var m={buttonDone:"OK",buttonFail:t,buttonsOrder:"done fail",customClass:"",filterDone:t,filterFail:t,input:!1,message:"",queue:!0,speed:200,top:"25%",width:"auto"},x={overlay:{"box-sizing":"border-box",display:"flex","flex-flow":"column nowrap","align-items":"center",position:"fixed",top:"0",left:"0",width:"100%",height:"100%"},spacer:{"box-sizing":"border-box",flex:"0 1 auto"},messagebox:{"box-sizing":"border-box",flex:"0 1 auto",display:"flex","flex-flow":"column nowrap"},content:{"box-sizing":"border-box",flex:"0 1 auto","overflow-y":"auto"},buttons:{"box-sizing":"border-box",flex:"0 0 auto"},boxSizing:{"box-sizing":"border-box"}},h=t,v=[],y=[],_={buttonDoneName:"buttonDone",buttonFailName:"buttonFail",errorSpeed:200,keyCodeDone:[13],keyCodeFail:[27],maxHeightCoefficient:1.5,topBuffer:100};e.MessageBoxSetup=function(t){e.extend(!0,m,t)},e.MessageBox=function(t){e.isPlainObject(t)||(t={message:t});var s=e.Deferred(),a=e.extend(!0,{},m,t);a.top=e.trim(a.top).toLowerCase(),e(document.activeElement).not(".messagebox_content_input").trigger("blur");var i={deferred:s,keyCodes:{},settings:a};return a.queue?(y.push(i),o()):(h&&v.push(h),n(i)),s.promise()},e(function(){e(window).on("resize",g).on("keydown",b)})}(jQuery),window.Woo_Folder_Selection=function(window,document,$,undefined){"use strict";var app={};return app.init=function(){function setMultipleSelection(){is_multiple_selection=!0,$(".single_add_to_cart_button").attr("disabled","disabled"),$("body").trigger("custom-folder-selection-init"),console.log("is_multiple_selection",is_multiple_selection)}function clearMultipleSelection(){$(document).find("#variation_pa_color-picker .label label").text("Choose Your Color"),is_multiple_selection=!1,$(document).find("#variation_pa_color-picker ul").remove(),$(".colorQty_quantity").val(1).trigger("change")}function getUpdate(){jQuery.post({url:jsobject.ajaxurl,data:{action:"woo_folder_get_update"},success:function(response){console.log(response),update_view(response.data)},error:function(errorThrown){console.log(errorThrown)}})}function deleteProduct(){$("body").addClass("processing"),jQuery.post({url:jsobject.ajaxurl,data:{action:"woo_folder_delete_product",id:productId},success:function(response){console.log(response),update_view(response.data),$("body").removeClass("processing")},error:function(errorThrown){console.log(errorThrown)}})}function update_view(json){if(!1!==is_multiple_selection){var updated_total=0;$(".variation_buttons").find(".multiple-qty").remove();for(var key in json)if(json.hasOwnProperty(key)){if(parseInt(json[key].id)!==productId){console.log(json[key].id,productId);continue}$(".variation_buttons").find("#"+json[key].variation).eq(0).prepend('<span class="multiple-qty">'+json[key].qty+"</span>"),updated_total+=parseInt(json[key].qty)}if(updated_total<1)return!1;$(document).find("#variation_pa_color-picker .label label").text("Choose Your Color ("+updated_total+")"),updated_total>=minRequired?(console.log(updated_total),console.log("block1"),$(".colorQty_quantity").val(updated_total).trigger("change"),$(".single_add_to_cart_button").removeAttr("disabled")):(console.log("block2"),$(".colorQty_quantity").val(minRequired).trigger("change"),$(".single_add_to_cart_button").attr("disabled","disabled"))}else clearMultipleSelection()}console.log(jsobject);var productId=$("form.cart").data("product_id"),is_multiple_selection=!1,minRequired=0;getUpdate(),$(document).on("change","#pa_pack-type",function(){var choose=parseInt($(this).val());console.log(choose),$.isNumeric(choose)&&choose>=jsobject.min_required?(minRequired=choose,setMultipleSelection(),getUpdate()):(is_multiple_selection&&(deleteProduct(),window.location.reload()),clearMultipleSelection())}),$(document).on("click",".reset_variations",function(){deleteProduct()}),$(document).on("click",".variation_button",function(){if(is_multiple_selection){var title=$(this).attr("title"),slug=$(this).attr("id"),qty=!1;$.MessageBox({input:!0,message:"Please input the quantity for "+title}).done(function(data){if(!$.trim(data))return!1;qty=$.trim(data),$("body").addClass("processing"),jQuery.post({url:jsobject.ajaxurl,data:{action:"woo_folder_save_product",id:productId,title:title,variation:slug,qty:qty},success:function(response){console.log(response),$("body").removeClass("processing"),update_view(response.data)},error:function(errorThrown){console.log(errorThrown)}})}),console.log(qty)}})},$(document).ready(app.init),app}(window,document,jQuery);